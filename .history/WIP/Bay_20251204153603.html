<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bay Display</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    * {
        margin: 10;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        margin: 0;
        background: #c8cdd3;
        color: #1a1a1a;
        font-family: 'Segoe UI', 'Arial', system-ui, sans-serif;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* === TOP THIRD - BAY NUMBER + DCS === */
    .bay-section {
        height: 33vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .bay-title {
        font-size: 250px;
        font-weight: 800;
        letter-spacing: 8px;
        text-transform: uppercase;
        line-height: 1;
    }

    .company-name {
        font-size: 50px;
        font-weight: 500;
        letter-spacing: 6px;
        color: #555;
    }

    /* === BOTTOM SECTION === */
    .main-section {
        flex: 1;
        display: flex;
        padding: 20px 60px 60px 60px;
        gap: 50px;
        align-items: center;
    }

    /* === LEFT - LORRY ICON === */
    .left-panel {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .lorry-icon {
        height: 180px;
        width: auto;
    }

    .lorry-icon svg {
        height: 100%;
        width: auto;
        fill: #1a1a1a;
    }

    /* === RIGHT - INFO CARD === */
    .right-panel {
        flex: 1;
        display: flex;
        align-items: center;
    }

    .info-card {
        background: #e8ebef;
        border-radius: 20px;
        padding: 40px 50px;
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        gap: 40px;
        width: 100%;
        height: 180px;
        box-shadow: 
            0 4px 8px rgba(0,0,0,0.1),
            inset 0 2px 0 rgba(255,255,255,0.5);
    }

    .reg-box {
        background: #1a1a1a;a<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bay Display</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        margin: 0;
        background: #c8cdd3;
        color: #1a1a1a;
        font-family: 'Segoe UI', 'Arial', system-ui, sans-serif;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* === TOP THIRD - BAY NUMBER + DCS === */
    .bay-section {
        height: 33vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .bay-title {
        font-size: 200px;
        font-weight: 800;
        letter-spacing: 8px;
        text-transform: uppercase;
        line-height: 1;
    }

    .company-name {
        font-size: 36px;
        font-weight: 500;
        letter-spacing: 6px;
        color: #555;
    }

    /* === BOTTOM SECTION === */
    .main-section {
        flex: 1;
        display: flex;
        padding: 20px 60px 60px 60px;
        gap: 50px;
        align-items: center;
    }

    /* === LEFT - LORRY ICON === */
    .left-panel {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .lorry-icon {
        height: 180px;
        width: auto;
    }

    .lorry-icon svg {
        height: 100%;
        width: auto;
        fill: #1a1a1a;
    }

    /* === RIGHT - INFO CARD === */
    .right-panel {
        flex: 1;
        display: flex;
        align-items: center;
    }

    .info-card {
        background: #e8ebef;
        border-radius: 20px;
        padding: 40px 50px;
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        gap: 40px;
        width: 100%;
        height: 180px;
        box-shadow: 
            0 4px 8px rgba(0,0,0,0.1),
            inset 0 2px 0 rgba(255,255,255,0.5);
        transition: all 0.3s ease;
    }

    .reg-box {
        background: #1a1a1a;
        color: #fbbf24;
        font-size: 56px;
        font-weight: 800;
        padding: 18px 32px;
        border-radius: 12px;
        letter-spacing: 5px;
        font-family: 'Courier New', monospace;
        transition: all 0.3s ease;
    }

    .info-middle {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .info-label {
        font-size: 22px;
        color: #666;
    }

    .info-ref {
        font-size: 38px;
        font-weight: 600;
        font-family: 'Courier New', monospace;
        letter-spacing: 2px;
        transition: all 0.3s ease;
    }

    .time-display {
        font-size: 72px;
        font-weight: 700;
        letter-spacing: 2px;
    }

    .time-display .colon {
        opacity: 0.4;
        margin: 0 2px;
    }

    /* === IDLE STATE === */
    .info-card.idle {
        background: #dde0e5;
    }

    .info-card.idle .reg-box {
        background: #888;
        color: #bbb;
    }

    .info-card.idle .info-ref {
        color: #888;
    }

    .info-card.idle .lorry-icon svg {
        fill: #888;
    }

    body.idle .lorry-icon svg {
        fill: #888;
    }

    /* === SUBTLE BRANDING === */
    .footer-brand {
        position: fixed;
        bottom: 20px;
        right: 40px;
        font-size: 16px;
        color: #999;
        letter-spacing: 3px;
    }

    .status-dot {
        position: fixed;
        bottom: 24px;
        left: 40px;
        width: 12px;
        height: 12px;
        background: #22c55e;
        border-radius: 50%;
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
        animation: pulse 2s infinite;
    }

    .status-dot.disconnected {
        background: #ef4444;
        box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
</style>
</head>

<body>

<!-- TOP THIRD: Bay Number + Company -->
<div class="bay-section">
    <div class="bay-title">Bay <span id="bayNumber">-</span></div>
    <div class="company-name">DCS Logistics</div>
</div>

<!-- BOTTOM SECTION -->
<div class="main-section">

    <!-- Left: Lorry Icon -->
    <div class="left-panel">
        <div class="lorry-icon">
            <svg viewBox="0 0 100 55" xmlns="http://www.w3.org/2000/svg">
                <!-- Cab -->
                <rect x="65" y="12" width="30" height="28" rx="3"/>
                <!-- Windscreen -->
                <rect x="70" y="15" width="20" height="11" rx="2" fill="#c8cdd3"/>
                <!-- Trailer -->
                <rect x="5" y="8" width="62" height="32" rx="2"/>
                <!-- Chassis -->
                <rect x="5" y="40" width="90" height="5"/>
                <!-- Front wheel -->
                <circle cx="80" cy="48" r="7"/>
                <circle cx="80" cy="48" r="3.5" fill="#c8cdd3"/>
                <!-- Rear wheels -->
                <circle cx="25" cy="48" r="7"/>
                <circle cx="25" cy="48" r="3.5" fill="#c8cdd3"/>
                <circle cx="42" cy="48" r="7"/>
                <circle cx="42" cy="48" r="3.5" fill="#c8cdd3"/>
            </svg>
        </div>
    </div>

    <!-- Right: Info Card -->
    <div class="right-panel">
        <div class="info-card idle" id="infoCard">
            <div class="reg-box" id="regBox">-------</div>
            <div class="info-middle">
                <div class="info-label">Reference</div>
                <div class="info-ref" id="refText">Awaiting vehicle</div>
            </div>
            <div class="time-display">
                <span id="timeHour">--</span><span class="colon">:</span><span id="timeMin">--</span>
            </div>
        </div>
    </div>

</div>

<div class="status-dot" id="statusDot"></div>
<div class="footer-brand">LORRY PARK</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// ==================== CONFIG ====================
const db = supabase.createClient(
    "https://gtixdparpjdpyhhubsfz.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0aXhkcGFycGpkcHloaHVic2Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MDUxNDksImV4cCI6MjA3ODk4MTE0OX0.jQdd18hGPESpDi7IvXWBZK0_bDy4-DKoSGHtZZpxAP0"
);

// Get bay number from URL parameter
const urlParams = new URLSearchParams(window.location.search);
const BAY_NUMBER = parseInt(urlParams.get('bay')) || 1;

document.getElementById('bayNumber').textContent = BAY_NUMBER;
document.title = `Bay ${BAY_NUMBER} - DCS Logistics`;

let currentVehicle = null;

// ==================== CLOCK ====================
function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const mins = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('timeHour').textContent = hours;
    document.getElementById('timeMin').textContent = mins;
}
updateClock();
setInterval(updateClock, 1000);

// ==================== DISPLAY FUNCTIONS ====================
function showVehicle(vehicle) {
    currentVehicle = vehicle;
    
    const card = document.getElementById('infoCard');
    card.classList.remove('idle');
    document.body.classList.remove('idle');
    
    const reg = vehicle.registration || '-------';
    document.getElementById('regBox').textContent = reg.replace(/\s/g, '');
    document.getElementById('refText').textContent = vehicle.po_ref || '--';
}

function showIdle() {
    currentVehicle = null;
    
    const card = document.getElementById('infoCard');
    card.classList.add('idle');
    document.body.classList.add('idle');
    
    document.getElementById('regBox').textContent = '-------';
    document.getElementById('refText').textContent = 'Awaiting vehicle';
}

// ==================== LOAD DATA ====================
async function loadBayVehicle() {
    try {
        const { data, error } = await db
            .from('vehicles')
            .select('*')
            .eq('status', 'notified')
            .eq('bay', BAY_NUMBER)
            .limit(1)
            .single();

        if (error && error.code !== 'PGRST116') {
            // PGRST116 = no rows found (that's fine, show idle)
            console.error('Error loading vehicle:', error);
            return;
        }

        if (data) {
            showVehicle(data);
        } else {
            showIdle();
        }

    } catch (err) {
        console.error('Load error:', err);
    }
}

// ==================== REALTIME ====================
function setupRealtime() {
    const channel = db
        .channel(`bay-${BAY_NUMBER}-display`)
        .on('postgres_changes',
            { event: '*', schema: 'public', table: 'vehicles' },
            (payload) => {
                console.log('Change detected:', payload.eventType, payload);
                // Reload whenever anything changes
                loadBayVehicle();
            }
        )
        .subscribe((status) => {
            const dot = document.getElementById('statusDot');
            if (status === 'SUBSCRIBED') {
                dot.classList.remove('disconnected');
                console.log('Realtime connected');
            } else if (status === 'CLOSED' || status === 'CHANNEL_ERROR') {
                dot.classList.add('disconnected');
                console.log('Realtime disconnected');
            }
        });
}

// ==================== INIT ====================
async function init() {
    await loadBayVehicle();
    setupRealtime();
    
    // Fallback refresh every 30 seconds
    setInterval(loadBayVehicle, 30000);
}

init();
</script>

</body>
</html>
        color: #fbbf24;
        font-size: 72px;
        font-weight: 800;
        padding: 22px 40px;
        border-radius: 14px;
        letter-spacing: 6px;
        font-family: 'Courier New', monospace;
        line-height: 1;
    }

    .info-middle {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .info-label {
        font-size: 22px;
        color: #666;
    }

    .info-ref {
        font-size: 48px;
        font-weight: 700;
        font-family: 'Courier New', monospace;
        letter-spacing: 3px;
        line-height: 1.1;
    }

    .time-display {
        font-size: 72px;
        font-weight: 700;
        letter-spacing: 2px;
    }

    .time-display .colon {
        opacity: 0.4;
        margin: 0 2px;
    }

    /* === IDLE STATE === */
    .info-card.idle {
        background: #dde0e5;
    }

    .info-card.idle .reg-box {
        background: #666;
        color: #999;
    }

    .info-card.idle .info-ref {
        color: #888;
    }

    /* === SUBTLE BRANDING === */
    .footer-brand {
        position: fixed;
        bottom: 20px;
        right: 40px;
        font-size: 16px;
        color: #999;
        letter-spacing: 3px;
    }
</style>
</head>

<body>

<!-- TOP THIRD: Bay Number + Company -->
<div class="bay-section">
    <div class="bay-title">Bay <span id="bayNumber">3</span></div>
    <div class="company-name">DCS Logistics</div>
</div>

<!-- BOTTOM SECTION -->
<div class="main-section">

    <!-- Left: Lorry Icon -->
    <div class="left-panel">
        <div class="lorry-icon">
            <svg viewBox="0 0 100 55" xmlns="http://www.w3.org/2000/svg">
                <!-- Cab -->
                <rect x="65" y="12" width="30" height="28" rx="3"/>
                <!-- Windscreen -->
                <rect x="70" y="15" width="20" height="11" rx="2" fill="#c8cdd3"/>
                <!-- Trailer -->
                <rect x="5" y="8" width="62" height="32" rx="2"/>
                <!-- Chassis -->
                <rect x="5" y="40" width="90" height="5"/>
                <!-- Front wheel -->
                <circle cx="80" cy="48" r="7"/>
                <circle cx="80" cy="48" r="3.5" fill="#c8cdd3"/>
                <!-- Rear wheels -->
                <circle cx="25" cy="48" r="7"/>
                <circle cx="25" cy="48" r="3.5" fill="#c8cdd3"/>
                <circle cx="42" cy="48" r="7"/>
                <circle cx="42" cy="48" r="3.5" fill="#c8cdd3"/>
            </svg>
        </div>
    </div>

    <!-- Right: Info Card -->
    <div class="right-panel">
        <div class="info-card" id="infoCard">
            <div class="reg-box" id="regBox">AB12CDE</div>
            <div class="info-middle">
                <div class="info-label">Reference</div>
                <div class="info-ref" id="refText">PO-12345678</div>
            </div>
            <div class="time-display">
                <span id="timeHour">14</span><span class="colon">:</span><span id="timeMin">32</span>
            </div>
        </div>
    </div>

</div>

<div class="footer-brand">LORRY PARK</div>

<script>
// ==================== CONFIG ====================
const urlParams = new URLSearchParams(window.location.search);
const BAY_NUMBER = urlParams.get('bay') || '3';

document.getElementById('bayNumber').textContent = BAY_NUMBER;

// ==================== CLOCK ====================
function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const mins = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('timeHour').textContent = hours;
    document.getElementById('timeMin').textContent = mins;
}
updateClock();
setInterval(updateClock, 1000);

// ==================== DISPLAY ====================
function showVehicle(reg, ref) {
    const card = document.getElementById('infoCard');
    card.classList.remove('idle');
    
    document.getElementById('regBox').textContent = reg.replace(/\s/g, '');
    document.getElementById('refText').textContent = ref || '--';
}

function showIdle() {
    const card = document.getElementById('infoCard');
    card.classList.add('idle');
    document.getElementById('regBox').textContent = '-------';
    document.getElementById('refText').textContent = 'Awaiting vehicle';
}

// ==================== DEMO ====================
showVehicle('AB12 CDE', 'PO-12345678');
</script>

</body>
</html>
